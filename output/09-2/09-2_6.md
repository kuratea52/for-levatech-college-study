# カテゴリーごとの投稿一覧表示をする

## ルーティングの設定

### 「blog/routes配下にあるweb.phpに、下記を追加してルーティング設定をする。
※ ルートから、「posts/」を経由せずに「/categories/{category}」と飛ぶようにする。

    use App\Http\Controllers\CategoryController;

    Route::get('/categories/{category}', [CategoryController::class,'index']);

## ルーティングで設定したCategoryControllerファイルを作成する。

### 「blog/app/Http/Controllers」配下にCategoryController.phpを作成し、下記を記載する。

    <?php

    namespace App\Http\Controllers;

    use App\Models\Category;

    class CategoryController extends Controller
    {
        public function index(Category $category)
        {
            return view('categories.index')->with(['posts' => $category->getByCategory()]);
        }
    }
    ?>

## Categoryモデルに、自身に属する投稿を取得する処理を追加

### 「blog/app/Models配下にあるCategory.phpに、下記を追加する。

    public function getByCategory(int $limit_count = 5)
    {
        return $this->posts()->with('category')->orderBy('updated_at', 'DESC')->paginate($limit_count);
        // $thisインスタンスを通してCategoryクラスにアクセスする。postsメソッドにはhasManyがあることでリレーションの関係になり、さらにwithメソッドでpostsテーブルに関連したcategoriesテーブルのデータを呼び出している。
    }

## viewファイルの準備